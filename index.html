<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento de Convidados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49B8'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .table-row:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }
        
        .dark .table-row:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .loading {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg text-center">
            <div class="loading inline-block w-8 h-8 border-4 border-primary border-t-transparent rounded-full mb-4"></div>
            <p class="text-gray-700 dark:text-gray-300">Processando...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-primary text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">Sistema de Gerenciamento de Convidados</h1>
            <div class="flex items-center space-x-4">
                <div id="connection-status" class="flex items-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                    <span class="text-sm">Conectado</span>
                </div>
                <button onclick="syncDatabase()" class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded">
                    üîÑ Sync
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 pb-20">
        <!-- P√°gina de Busca -->
        <div id="busca-page" class="page-content">
            <div class="fade-in">
                <h2 class="text-2xl font-bold mb-6 text-center">Lista de Convidados</h2>
                
                <!-- Campo de busca centralizado -->
                <div class="max-w-md mx-auto mb-8">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="search-input" 
                            placeholder="Digite o nome do representante..."
                            class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-800"
                        >
                        <button 
                            onclick="buscarConvidados()"
                            class="absolute right-3 top-3 text-gray-400 hover:text-primary"
                        >
                            üîç
                        </button>
                    </div>
                </div>

                <!-- Resultados da busca -->
                <div id="search-results" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                    <div class="p-6 text-center text-gray-500 dark:text-gray-400">
                        Digite um nome para buscar convidados
                    </div>
                </div>

                <!-- Selecionados -->
                <div id="selected-section" class="mt-6 hidden">
                    <h3 class="text-lg font-semibold mb-4">Convidados Selecionados</h3>
                    <div id="selected-list" class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-4">
                        <button 
                            onclick="enviarParaRelatorio()"
                            class="bg-primary hover:bg-primary-dark text-white py-3 px-6 rounded-lg font-semibold transition-colors"
                        >
                            Confirmar Convidados
                        </button>
                        <button 
                            onclick="cancelarConvidados()"
                            class="bg-red-500 hover:bg-red-600 text-white py-3 px-6 rounded-lg font-semibold transition-colors"
                        >
                            Cancelar Convidados
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°gina de Gerenciamento -->
        <div id="gerenciamento-page" class="page-content hidden">
            <div class="fade-in">
                <h2 class="text-2xl font-bold mb-6">Gerenciamento de Convidados</h2>
                
                <!-- Estat√≠sticas -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 dark:text-blue-200">Total de Convidados</h3>
                        <p id="total-pedidos" class="text-2xl font-bold text-blue-600 dark:text-blue-300">0</p>
                    </div>
                    <div class="bg-green-100 dark:bg-green-900 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800 dark:text-green-200">Confirmados</h3>
                        <p id="total-confirmados" class="text-2xl font-bold text-green-600 dark:text-green-300">0</p>
                    </div>
                    <div class="bg-yellow-100 dark:bg-yellow-900 p-4 rounded-lg">
                        <h3 class="font-semibold text-yellow-800 dark:text-yellow-200">Pendentes</h3>
                        <p id="total-pendentes" class="text-2xl font-bold text-yellow-600 dark:text-yellow-300">0</p>
                    </div>
                </div>

                <!-- Formul√°rio de adi√ß√£o e importa√ß√£o -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
                    <h3 class="text-lg font-semibold mb-4">Adicionar Convidados</h3>
                    
                    <!-- Adicionar individual -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input 
                            type="text" 
                            id="novo-representante" 
                            placeholder="Nome do Representante"
                            class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                        <input 
                            type="text" 
                            id="novo-convidado" 
                            placeholder="Nome do Convidado"
                            class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                    </div>
                    <button 
                        onclick="adicionarPedido()"
                        class="bg-primary hover:bg-primary-dark text-white py-2 px-6 rounded-lg font-semibold transition-colors mb-4"
                    >
                        Adicionar Convidado
                    </button>
                    
                    <!-- Importar lista -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="text-md font-semibold mb-3">Importar Lista de Convidados</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                            Formato: uma linha por convidado, separado por v√≠rgula (Representante, Convidado) ou arquivo Excel
                        </p>
                        <textarea 
                            id="lista-importar" 
                            placeholder="Exemplo:&#10;Jo√£o Silva, Maria Santos&#10;Ana Costa, Pedro Oliveira&#10;Carlos Pereira, Sofia Rodrigues"
                            rows="4"
                            class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700 mb-3"
                        ></textarea>
                        <div class="flex gap-3 mb-3">
                            <button 
                                onclick="importarLista()"
                                class="bg-green-500 hover:bg-green-600 text-white py-2 px-6 rounded-lg font-semibold transition-colors"
                            >
                                Importar Lista
                            </button>
                            <input 
                                type="file" 
                                id="arquivo-excel" 
                                accept=".xlsx,.xls,.csv"
                                class="hidden"
                                onchange="importarExcel()"
                            >
                            <button 
                                onclick="document.getElementById('arquivo-excel').click()"
                                class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-lg font-semibold transition-colors"
                            >
                                üìä Importar Excel
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                            Excel: 1¬™ coluna = Representante, 2¬™ coluna = Convidado
                        </p>
                    </div>

                    <!-- Backup e Restore -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                        <h4 class="text-md font-semibold mb-3">Backup e Restaura√ß√£o</h4>
                        <div class="flex gap-3">
                            <button 
                                onclick="exportarBackup()"
                                class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-6 rounded-lg font-semibold transition-colors"
                            >
                                üíæ Backup
                            </button>
                            <input 
                                type="file" 
                                id="arquivo-backup" 
                                accept=".json"
                                class="hidden"
                                onchange="importarBackup()"
                            >
                            <button 
                                onclick="document.getElementById('arquivo-backup').click()"
                                class="bg-orange-500 hover:bg-orange-600 text-white py-2 px-6 rounded-lg font-semibold transition-colors"
                            >
                                üìÇ Restaurar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filtro de busca -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg mb-6">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="filtro-gerenciamento" 
                            placeholder="Buscar por representante ou convidado..."
                            onkeyup="filtrarConvidados()"
                            class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-800"
                        >
                        <button 
                            onclick="filtrarConvidados()"
                            class="absolute right-3 top-3 text-gray-400 hover:text-primary"
                        >
                            üîç
                        </button>
                    </div>
                </div>

                <!-- Tabela de convidados -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Representante</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Convidado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="pedidos-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dados ser√£o inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°gina de Relat√≥rio -->
        <div id="relatorio-page" class="page-content hidden">
            <div class="fade-in">
                <h2 class="text-2xl font-bold mb-6">Relat√≥rio de Confirma√ß√µes</h2>
                
                <!-- Configura√ß√µes -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
                    <h3 class="text-lg font-semibold mb-4">Configura√ß√µes</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <button 
                            onclick="exportarDados()"
                            class="bg-green-500 hover:bg-green-600 text-white py-2 px-6 rounded-lg font-semibold transition-colors"
                        >
                            üìä Exportar Tabela
                        </button>
                        <button 
                            onclick="gerarRelatorioCompleto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-lg font-semibold transition-colors"
                        >
                            üìà Relat√≥rio Completo
                        </button>
                    </div>
                    
                    <!-- Campo para alterar senha -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="text-md font-semibold mb-3">Alterar Senha de Acesso</h4>
                        <div class="flex gap-3">
                            <input 
                                type="password" 
                                id="nova-senha" 
                                placeholder="Nova senha"
                                class="flex-1 px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                            >
                            <button 
                                onclick="alterarSenha()"
                                class="bg-primary hover:bg-primary-dark text-white py-2 px-6 rounded-lg font-semibold transition-colors"
                            >
                                Alterar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estat√≠sticas por representante -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
                    <h3 class="text-lg font-semibold mb-4">Estat√≠sticas por Representante</h3>
                    <div id="stats-representantes" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Estat√≠sticas ser√£o inseridas aqui -->
                    </div>
                </div>

                <!-- Filtros de busca -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Filtro de busca por texto -->
                        <div class="relative">
                            <input 
                                type="text" 
                                id="filtro-relatorio-busca" 
                                placeholder="Buscar por representante ou convidado..."
                                onkeyup="aplicarFiltros()"
                                class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-800"
                            >
                            <button 
                                onclick="aplicarFiltros()"
                                class="absolute right-3 top-3 text-gray-400 hover:text-primary"
                            >
                                üîç
                            </button>
                        </div>
                        
                        <select 
                            id="filtro-representante"
                            onchange="aplicarFiltros()"
                            class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                            <option value="">Todos os Representantes</option>
                        </select>
                        
                        <select 
                            id="filtro-status"
                            onchange="aplicarFiltros()"
                            class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                            <option value="">Todos os Status</option>
                            <option value="Confirmado">Confirmado</option>
                            <option value="Pendente">Pendente</option>
                        </select>
                    </div>
                </div>

                <!-- Lista de confirma√ß√µes -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                    <h3 class="text-lg font-semibold p-6 border-b border-gray-200 dark:border-gray-700">Confirma√ß√µes</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Representante</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Convidado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">√öltima Atualiza√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody id="relatorio-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dados ser√£o inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Menu inferior de navega√ß√£o -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg">
        <div class="flex justify-around py-2">
            <button 
                onclick="mostrarPagina('busca')" 
                id="nav-busca"
                class="nav-btn flex flex-col items-center py-2 px-4 text-primary font-semibold"
            >
                <span class="text-lg">üîç</span>
                <span class="text-xs">Lista de Convidados</span>
            </button>
            <button 
                onclick="mostrarPagina('gerenciamento')" 
                id="nav-gerenciamento"
                class="nav-btn flex flex-col items-center py-2 px-4 text-gray-500 hover:text-primary transition-colors"
            >
                <span class="text-lg">‚öôÔ∏è</span>
                <span class="text-xs">Gerenciar</span>
            </button>
            <button 
                onclick="mostrarPagina('relatorio')" 
                id="nav-relatorio"
                class="nav-btn flex flex-col items-center py-2 px-4 text-gray-500 hover:text-primary transition-colors"
            >
                <span class="text-lg">üìä</span>
                <span class="text-xs">Relat√≥rio</span>
            </button>
        </div>
    </nav>

    <script>
        // ==================== SISTEMA DE BANCO DE DADOS SIMULADO ====================
        
        // Simula√ß√£o de um banco de dados com opera√ß√µes CRUD
        class DatabaseService {
            constructor() {
                this.dbName = 'convidados_db';
                this.version = '1.0';
                this.initialized = false;
                this.data = {
                    convidados: [],
                    configuracoes: {
                        senha: '1234',
                        proximoId: 1
                    },
                    logs: []
                };
                this.init();
            }

            async init() {
                try {
                    await this.loadDatabase();
                    this.initialized = true;
                    this.updateConnectionStatus(true);
                    console.log('üóÑÔ∏è Database inicializado com sucesso');
                } catch (error) {
                    console.error('‚ùå Erro ao inicializar database:', error);
                    this.updateConnectionStatus(false);
                }
            }

            updateConnectionStatus(connected) {
                const statusEl = document.getElementById('connection-status');
                if (connected) {
                    statusEl.innerHTML = '<div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div><span class="text-sm">Conectado</span>';
                } else {
                    statusEl.innerHTML = '<div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div><span class="text-sm">Desconectado</span>';
                }
            }

            async loadDatabase() {
                // Simula carregamento do banco de dados
                // Em um sistema real, isso seria uma chamada para API
                return new Promise((resolve) => {
                    setTimeout(() => {
                        // Dados iniciais para demonstra√ß√£o
                        if (this.data.convidados.length === 0) {
                            this.data.convidados = [
                                { 
                                    id: 1, 
                                    representante: 'Jo√£o Silva', 
                                    convidado: 'Maria Santos', 
                                    status: 'Confirmado', 
                                    data_criacao: '2024-01-15',
                                    data_atualizacao: '2024-01-15 10:30:00'
                                },
                                { 
                                    id: 2, 
                                    representante: 'Ana Costa', 
                                    convidado: 'Pedro Oliveira', 
                                    status: 'Pendente', 
                                    data_criacao: '2024-01-16',
                                    data_atualizacao: '2024-01-16 14:15:00'
                                },
                                { 
                                    id: 3, 
                                    representante: 'Jo√£o Silva', 
                                    convidado: 'Lucas Lima', 
                                    status: 'Confirmado', 
                                    data_criacao: '2024-01-17',
                                    data_atualizacao: '2024-01-17 09:45:00'
                                },
                                { 
                                    id: 4, 
                                    representante: 'Carlos Pereira', 
                                    convidado: 'Sofia Rodrigues', 
                                    status: 'Confirmado', 
                                    data_criacao: '2024-01-18',
                                    data_atualizacao: '2024-01-18 16:20:00'
                                }
                            ];
                            this.data.configuracoes.proximoId = 5;
                        }
                        resolve();
                    }, 500); // Simula lat√™ncia de rede
                });
            }

            async insert(table, data) {
                showLoading(true);
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        try {
                            if (table === 'convidados') {
                                const novoRegistro = {
                                    ...data,
                                    id: this.data.configuracoes.proximoId++,
                                    data_criacao: new Date().toISOString().split('T')[0],
                                    data_atualizacao: new Date().toLocaleString('pt-BR')
                                };
                                this.data.convidados.push(novoRegistro);
                                this.logOperation('INSERT', 'convidados', novoRegistro.id);
                                resolve(novoRegistro);
                            }
                        } catch (error) {
                            reject(error);
                        } finally {
                            showLoading(false);
                        }
                    }, 200);
                });
            }

            async update(table, id, data) {
                showLoading(true);
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        try {
                            if (table === 'convidados') {
                                const index = this.data.convidados.findIndex(item => item.id === id);
                                if (index !== -1) {
                                    this.data.convidados[index] = {
                                        ...this.data.convidados[index],
                                        ...data,
                                        data_atualizacao: new Date().toLocaleString('pt-BR')
                                    };
                                    this.logOperation('UPDATE', 'convidados', id);
                                    resolve(this.data.convidados[index]);
                                } else {
                                    reject(new Error('Registro n√£o encontrado'));
                                }
                            }
                        } catch (error) {
                            reject(error);
                        } finally {
                            showLoading(false);
                        }
                    }, 150);
                });
            }

            async delete(table, id) {
                showLoading(true);
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        try {
                            if (table === 'convidados') {
                                const index = this.data.convidados.findIndex(item => item.id === id);
                                if (index !== -1) {
                                    const deleted = this.data.convidados.splice(index, 1)[0];
                                    this.logOperation('DELETE', 'convidados', id);
                                    resolve(deleted);
                                } else {
                                    reject(new Error('Registro n√£o encontrado'));
                                }
                            }
                        } catch (error) {
                            reject(error);
                        } finally {
                            showLoading(false);
                        }
                    }, 150);
                });
            }

            async select(table, filters = {}) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (table === 'convidados') {
                            let result = [...this.data.convidados];
                            
                            // Aplicar filtros
                            if (filters.representante) {
                                result = result.filter(item => 
                                    item.representante.toLowerCase().includes(filters.representante.toLowerCase())
                                );
                            }
                            if (filters.convidado) {
                                result = result.filter(item => 
                                    item.convidado.toLowerCase().includes(filters.convidado.toLowerCase())
                                );
                            }
                            if (filters.status) {
                                result = result.filter(item => item.status === filters.status);
                            }
                            if (filters.busca) {
                                const termo = filters.busca.toLowerCase();
                                result = result.filter(item => 
                                    item.representante.toLowerCase().includes(termo) ||
                                    item.convidado.toLowerCase().includes(termo)
                                );
                            }
                            
                            resolve(result);
                        }
                    }, 100);
                });
            }

            async bulkInsert(table, dataArray) {
                showLoading(true);
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        try {
                            if (table === 'convidados') {
                                const novosRegistros = dataArray.map(data => ({
                                    ...data,
                                    id: this.data.configuracoes.proximoId++,
                                    data_criacao: new Date().toISOString().split('T')[0],
                                    data_atualizacao: new Date().toLocaleString('pt-BR')
                                }));
                                
                                this.data.convidados.push(...novosRegistros);
                                this.logOperation('BULK_INSERT', 'convidados', novosRegistros.length);
                                resolve(novosRegistros);
                            }
                        } catch (error) {
                            reject(error);
                        } finally {
                            showLoading(false);
                        }
                    }, 300);
                });
            }

            logOperation(operation, table, id) {
                this.data.logs.push({
                    timestamp: new Date().toLocaleString('pt-BR'),
                    operation,
                    table,
                    id,
                    user: 'Sistema'
                });
                
                // Manter apenas os √∫ltimos 100 logs
                if (this.data.logs.length > 100) {
                    this.data.logs = this.data.logs.slice(-100);
                }
            }

            async getStats() {
                const convidados = await this.select('convidados');
                const total = convidados.length;
                const confirmados = convidados.filter(c => c.status === 'Confirmado').length;
                const pendentes = convidados.filter(c => c.status === 'Pendente').length;
                
                // Estat√≠sticas por representante
                const porRepresentante = {};
                convidados.forEach(c => {
                    if (!porRepresentante[c.representante]) {
                        porRepresentante[c.representante] = { total: 0, confirmados: 0 };
                    }
                    porRepresentante[c.representante].total++;
                    if (c.status === 'Confirmado') {
                        porRepresentante[c.representante].confirmados++;
                    }
                });

                return {
                    total,
                    confirmados,
                    pendentes,
                    taxa_confirmacao: total > 0 ? Math.round((confirmados / total) * 100) : 0,
                    por_representante: porRepresentante
                };
            }

            exportData() {
                return {
                    ...this.data,
                    export_date: new Date().toISOString(),
                    version: this.version
                };
            }

            async importData(data) {
                showLoading(true);
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        try {
                            // Validar estrutura dos dados
                            if (!data.convidados || !Array.isArray(data.convidados)) {
                                throw new Error('Formato de dados inv√°lido');
                            }
                            
                            this.data = {
                                ...data,
                                logs: data.logs || []
                            };
                            
                            this.logOperation('IMPORT', 'database', data.convidados.length);
                            resolve();
                        } catch (error) {
                            reject(error);
                        } finally {
                            showLoading(false);
                        }
                    }, 500);
                });
            }
        }

        // ==================== INICIALIZA√á√ÉO E VARI√ÅVEIS GLOBAIS ====================
        
        // Configura√ß√£o do modo escuro
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Inst√¢ncia do banco de dados
        const db = new DatabaseService();
        
        // Vari√°veis globais
        let convidadosSelecionados = [];
        let paginaAtual = 'busca';

        // ==================== FUN√á√ïES DE UTILIDADE ====================
        
        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        async function syncDatabase() {
            showLoading(true);
            try {
                await db.loadDatabase();
                showCustomAlert('üîÑ Sincroniza√ß√£o conclu√≠da com sucesso!');
                
                // Atualizar a p√°gina atual
                if (paginaAtual === 'gerenciamento') {
                    await atualizarTabelaPedidos();
                    await atualizarEstatisticas();
                } else if (paginaAtual === 'relatorio') {
                    await atualizarRelatorio();
                }
            } catch (error) {
                showCustomAlert('‚ùå Erro na sincroniza√ß√£o: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // ==================== NAVEGA√á√ÉO ENTRE P√ÅGINAS ====================
        
        async function mostrarPagina(pagina) {
            // Verificar senha para p√°ginas protegidas
            if ((pagina === 'gerenciamento' || pagina === 'relatorio') && paginaAtual === 'busca') {
                showPasswordDialog(pagina);
                return;
            }
            
            // Limpar filtros da p√°gina anterior
            limparFiltrosPagina(paginaAtual);
            
            // Esconder todas as p√°ginas
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Mostrar p√°gina selecionada
            document.getElementById(pagina + '-page').classList.remove('hidden');
            
            // Atualizar navega√ß√£o
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-primary', 'font-semibold');
                btn.classList.add('text-gray-500');
            });
            
            document.getElementById('nav-' + pagina).classList.add('text-primary', 'font-semibold');
            document.getElementById('nav-' + pagina).classList.remove('text-gray-500');
            
            paginaAtual = pagina;
            
            // Atualizar dados da p√°gina
            if (pagina === 'gerenciamento') {
                await atualizarTabelaPedidos();
                await atualizarEstatisticas();
            } else if (pagina === 'relatorio') {
                await atualizarRelatorio();
            }
        }

        function limparFiltrosPagina(pagina) {
            if (pagina === 'busca') {
                document.getElementById('search-input').value = '';
            } else if (pagina === 'gerenciamento') {
                document.getElementById('filtro-gerenciamento').value = '';
            } else if (pagina === 'relatorio') {
                document.getElementById('filtro-relatorio-busca').value = '';
                document.getElementById('filtro-representante').value = '';
                document.getElementById('filtro-status').value = '';
            }
        }

        // ==================== P√ÅGINA DE BUSCA ====================
        
        async function buscarConvidados() {
            const termo = document.getElementById('search-input').value.toLowerCase();
            const resultados = document.getElementById('search-results');
            
            if (!termo.trim()) {
                resultados.innerHTML = '<div class="p-6 text-center text-gray-500 dark:text-gray-400">Digite um nome para buscar convidados</div>';
                return;
            }
            
            try {
                const convidados = await db.select('convidados', { busca: termo });
                
                if (convidados.length === 0) {
                    resultados.innerHTML = '<div class="p-6 text-center text-gray-500 dark:text-gray-400">Nenhum convidado encontrado</div>';
                    return;
                }
                
                let html = '<table class="w-full"><thead class="bg-gray-50 dark:bg-gray-700"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Convidado</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Representante</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Selecionar</th></tr></thead><tbody class="divide-y divide-gray-200 dark:divide-gray-700">';
                
                convidados.forEach(convidado => {
                    const isSelected = convidadosSelecionados.some(c => c.id === convidado.id);
                    html += `
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap">${convidado.convidado}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${convidado.representante}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${convidado.status === 'Confirmado' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'}">${convidado.status}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleConvidado(${convidado.id})" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                resultados.innerHTML = html;
            } catch (error) {
                resultados.innerHTML = '<div class="p-6 text-center text-red-500">Erro ao buscar convidados: ' + error.message + '</div>';
            }
        }

        async function toggleConvidado(id) {
            try {
                const convidados = await db.select('convidados');
                const convidado = convidados.find(c => c.id === id);
                const index = convidadosSelecionados.findIndex(c => c.id === id);
                
                if (index === -1) {
                    convidadosSelecionados.push(convidado);
                } else {
                    convidadosSelecionados.splice(index, 1);
                }
                
                atualizarSelecionados();
            } catch (error) {
                showCustomAlert('Erro ao selecionar convidado: ' + error.message);
            }
        }

        function atualizarSelecionados() {
            const section = document.getElementById('selected-section');
            const list = document.getElementById('selected-list');
            
            if (convidadosSelecionados.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            let html = '';
            
            convidadosSelecionados.forEach(convidado => {
                html += `
                    <div class="flex justify-between items-center py-2 px-4 bg-white dark:bg-gray-700 rounded mb-2">
                        <span>${convidado.convidado} (${convidado.representante})</span>
                        <button onclick="removerSelecionado(${convidado.id})" class="text-red-500 hover:text-red-700">‚ùå</button>
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        function removerSelecionado(id) {
            const index = convidadosSelecionados.findIndex(c => c.id === id);
            if (index !== -1) {
                convidadosSelecionados.splice(index, 1);
                atualizarSelecionados();
                buscarConvidados();
            }
        }

        async function enviarParaRelatorio() {
            if (convidadosSelecionados.length === 0) return;
            
            try {
                // Atualizar status para confirmado
                for (const convidado of convidadosSelecionados) {
                    await db.update('convidados', convidado.id, { status: 'Confirmado' });
                }
                
                convidadosSelecionados = [];
                atualizarSelecionados();
                buscarConvidados();
                
                showCustomAlert('‚úÖ Confirma√ß√£o de Convidados enviados aos noivos');
            } catch (error) {
                showCustomAlert('‚ùå Erro ao confirmar convidados: ' + error.message);
            }
        }

        async function cancelarConvidados() {
            if (convidadosSelecionados.length === 0) return;
            
            showConfirmDialog(`Tem certeza que deseja cancelar ${convidadosSelecionados.length} convidado(s) selecionado(s)?`, async () => {
                try {
                    // Atualizar status para pendente
                    for (const convidado of convidadosSelecionados) {
                        await db.update('convidados', convidado.id, { status: 'Pendente' });
                    }
                    
                    convidadosSelecionados = [];
                    atualizarSelecionados();
                    buscarConvidados();
                    
                    showCustomAlert('‚úÖ Convidados cancelados com sucesso!');
                } catch (error) {
                    showCustomAlert('‚ùå Erro ao cancelar convidados: ' + error.message);
                }
            });
        }

        // ==================== P√ÅGINA DE GERENCIAMENTO ====================
        
        async function adicionarPedido() {
            const representante = document.getElementById('novo-representante').value.trim();
            const convidado = document.getElementById('novo-convidado').value.trim();
            
            if (!representante || !convidado) {
                showCustomAlert('Por favor, preencha todos os campos');
                return;
            }
            
            try {
                await db.insert('convidados', {
                    representante,
                    convidado,
                    status: 'Pendente'
                });
                
                // Limpar campos
                document.getElementById('novo-representante').value = '';
                document.getElementById('novo-convidado').value = '';
                
                await atualizarTabelaPedidos();
                await atualizarEstatisticas();
                
                showCustomAlert('‚úÖ Convidado adicionado com sucesso!');
            } catch (error) {
                showCustomAlert('‚ùå Erro ao adicionar convidado: ' + error.message);
            }
        }

        async function atualizarTabelaPedidos() {
            try {
                const convidados = await db.select('convidados');
                const tbody = document.getElementById('pedidos-table');
                let html = '';
                
                convidados.forEach(convidado => {
                    html += `
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm">${convidado.id}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <input type="text" value="${convidado.representante}" onchange="editarPedido(${convidado.id}, 'representante', this.value)" class="w-full px-2 py-1 text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <input type="text" value="${convidado.convidado}" onchange="editarPedido(${convidado.id}, 'convidado', this.value)" class="w-full px-2 py-1 text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <select onchange="editarPedido(${convidado.id}, 'status', this.value)" class="px-2 py-1 text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                                    <option value="Pendente" ${convidado.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                    <option value="Confirmado" ${convidado.status === 'Confirmado' ? 'selected' : ''}>Confirmado</option>
                                </select>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">${convidado.data_criacao}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <button onclick="removerPedido(${convidado.id})" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            } catch (error) {
                showCustomAlert('‚ùå Erro ao carregar tabela: ' + error.message);
            }
        }

        async function editarPedido(id, campo, valor) {
            try {
                await db.update('convidados', id, { [campo]: valor });
                await atualizarEstatisticas();
            } catch (error) {
                showCustomAlert('‚ùå Erro ao editar convidado: ' + error.message);
            }
        }

        async function removerPedido(id) {
            showConfirmDialog('Tem certeza que deseja excluir o convidado?', async () => {
                try {
                    await db.delete('convidados', id);
                    await atualizarTabelaPedidos();
                    await atualizarEstatisticas();
                    showCustomAlert('‚úÖ Convidado removido com sucesso!');
                } catch (error) {
                    showCustomAlert('‚ùå Erro ao remover convidado: ' + error.message);
                }
            });
        }

        async function atualizarEstatisticas() {
            try {
                const stats = await db.getStats();
                
                document.getElementById('total-pedidos').textContent = stats.total;
                document.getElementById('total-confirmados').textContent = stats.confirmados;
                document.getElementById('total-pendentes').textContent = stats.pendentes;
            } catch (error) {
                console.error('Erro ao atualizar estat√≠sticas:', error);
            }
        }

        async function filtrarConvidados() {
            const termo = document.getElementById('filtro-gerenciamento').value.toLowerCase();
            
            try {
                const convidados = await db.select('convidados', { busca: termo });
                const tbody = document.getElementById('pedidos-table');
                let html = '';
                
                convidados.forEach(convidado => {
                    html += `
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm">${convidado.id}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <input type="text" value="${convidado.representante}" onchange="editarPedido(${convidado.id}, 'representante', this.value)" class="w-full px-2 py-1 text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <input type="text" value="${convidado.convidado}" onchange="editarPedido(${convidado.id}, 'convidado', this.value)" class="w-full px-2 py-1 text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <select onchange="editarPedido(${convidado.id}, 'status', this.value)" class="px-2 py-1 text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                                    <option value="Pendente" ${convidado.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                    <option value="Confirmado" ${convidado.status === 'Confirmado' ? 'selected' : ''}>Confirmado</option>
                                </select>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">${convidado.data_criacao}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <button onclick="removerPedido(${convidado.id})" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            } catch (error) {
                showCustomAlert('‚ùå Erro ao filtrar convidados: ' + error.message);
            }
        }

        async function importarLista() {
            const texto = document.getElementById('lista-importar').value.trim();
            
            if (!texto) {
                showCustomAlert('Por favor, digite a lista de convidados');
                return;
            }
            
            const linhas = texto.split('\n').filter(linha => linha.trim());
            const novosConvidados = [];
            let erros = 0;
            
            linhas.forEach(linha => {
                const partes = linha.split(',').map(parte => parte.trim());
                
                if (partes.length === 2 && partes[0] && partes[1]) {
                    novosConvidados.push({
                        representante: partes[0],
                        convidado: partes[1],
                        status: 'Pendente'
                    });
                } else {
                    erros++;
                }
            });
            
            if (novosConvidados.length === 0) {
                showCustomAlert('‚ùå Nenhum convidado v√°lido encontrado');
                return;
            }
            
            try {
                await db.bulkInsert('convidados', novosConvidados);
                
                // Limpar campo
                document.getElementById('lista-importar').value = '';
                
                // Atualizar tabela e estat√≠sticas
                await atualizarTabelaPedidos();
                await atualizarEstatisticas();
                
                // Mostrar resultado
                if (erros === 0) {
                    showCustomAlert(`‚úÖ ${novosConvidados.length} convidados importados com sucesso!`);
                } else {
                    showCustomAlert(`‚úÖ ${novosConvidados.length} convidados importados com sucesso! ${erros} linhas com erro foram ignoradas.`);
                }
            } catch (error) {
                showCustomAlert('‚ùå Erro ao importar lista: ' + error.message);
            }
        }

        async function importarExcel() {
            const arquivo = document.getElementById('arquivo-excel').files[0];
            
            if (!arquivo) {
                showCustomAlert('Por favor, selecione um arquivo');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                const data = e.target.result;
                let linhas = [];
                
                if (arquivo.name.toLowerCase().endsWith('.csv')) {
                    linhas = data.split('\n').map(linha => linha.split(','));
                } else {
                    showCustomAlert('Para arquivos Excel (.xlsx/.xls), por favor converta para CSV primeiro ou use a importa√ß√£o por texto.');
                    return;
                }
                
                await processarLinhasImportadas(linhas);
            };
            
            if (arquivo.name.toLowerCase().endsWith('.csv')) {
                reader.readAsText(arquivo);
            } else {
                showCustomAlert('Por favor, use arquivos CSV. Para Excel, salve como CSV primeiro.');
            }
        }
        
        async function processarLinhasImportadas(linhas) {
            const novosConvidados = [];
            let erros = 0;
            
            linhas.forEach((linha, index) => {
                // Pular cabe√ßalho se existir
                if (index === 0 && (linha[0].toLowerCase().includes('representante') || linha[0].toLowerCase().includes('nome'))) {
                    return;
                }
                
                // Limpar dados
                const representante = linha[0] ? linha[0].trim().replace(/"/g, '') : '';
                const convidado = linha[1] ? linha[1].trim().replace(/"/g, '') : '';
                
                if (representante && convidado) {
                    novosConvidados.push({
                        representante,
                        convidado,
                        status: 'Pendente'
                    });
                } else if (linha.length > 1 || linha[0].trim()) {
                    erros++;
                }
            });
            
            if (novosConvidados.length === 0) {
                showCustomAlert('‚ùå Nenhum convidado v√°lido encontrado no arquivo');
                return;
            }
            
            try {
                await db.bulkInsert('convidados', novosConvidados);
                
                // Limpar campo de arquivo
                document.getElementById('arquivo-excel').value = '';
                
                // Atualizar tabela e estat√≠sticas
                await atualizarTabelaPedidos();
                await atualizarEstatisticas();
                
                // Mostrar resultado
                if (erros === 0) {
                    showCustomAlert(`üìä ${novosConvidados.length} convidados importados com sucesso do arquivo!`);
                } else {
                    showCustomAlert(`üìä ${novosConvidados.length} convidados importados com sucesso! ${erros} linhas com erro foram ignoradas.`);
                }
            } catch (error) {
                showCustomAlert('‚ùå Erro ao importar arquivo: ' + error.message);
            }
        }

        function exportarBackup() {
            try {
                const data = db.exportData();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_convidados_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showCustomAlert('üíæ Backup exportado com sucesso!');
            } catch (error) {
                showCustomAlert('‚ùå Erro ao exportar backup: ' + error.message);
            }
        }

        function importarBackup() {
            const arquivo = document.getElementById('arquivo-backup').files[0];
            
            if (!arquivo) {
                showCustomAlert('Por favor, selecione um arquivo de backup');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    await db.importData(data);
                    
                    // Atualizar interface
                    await atualizarTabelaPedidos();
                    await atualizarEstatisticas();
                    
                    document.getElementById('arquivo-backup').value = '';
                    showCustomAlert('üìÇ Backup restaurado com sucesso!');
                } catch (error) {
                    showCustomAlert('‚ùå Erro ao restaurar backup: ' + error.message);
                }
            };
            
            reader.readAsText(arquivo);
        }

        // ==================== P√ÅGINA DE RELAT√ìRIO ====================
        
        async function atualizarRelatorio() {
            await atualizarFiltroRepresentantes();
            await aplicarFiltros();
            await atualizarEstatisticasRepresentantes();
        }

        async function atualizarFiltroRepresentantes() {
            try {
                const convidados = await db.select('convidados');
                const representantes = [...new Set(convidados.map(c => c.representante))];
                
                const select = document.getElementById('filtro-representante');
                let html = '<option value="">Todos os Representantes</option>';
                representantes.forEach(rep => {
                    html += `<option value="${rep}">${rep}</option>`;
                });
                
                select.innerHTML = html;
            } catch (error) {
                console.error('Erro ao atualizar filtro de representantes:', error);
            }
        }

        async function aplicarFiltros() {
            const filtroRep = document.getElementById('filtro-representante').value;
            const filtroStatus = document.getElementById('filtro-status').value;
            const filtroBusca = document.getElementById('filtro-relatorio-busca').value.toLowerCase();
            
            try {
                const filtros = {};
                if (filtroRep) filtros.representante = filtroRep;
                if (filtroStatus) filtros.status = filtroStatus;
                if (filtroBusca.trim()) filtros.busca = filtroBusca;
                
                const convidados = await db.select('convidados', filtros);
                const tbody = document.getElementById('relatorio-table');
                let html = '';
                
                convidados.forEach(convidado => {
                    html += `
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap">${convidado.representante}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${convidado.convidado}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${convidado.status === 'Confirmado' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'}">${convidado.status}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">${convidado.data_criacao}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">${convidado.data_atualizacao}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            } catch (error) {
                showCustomAlert('‚ùå Erro ao aplicar filtros: ' + error.message);
            }
        }

        async function atualizarEstatisticasRepresentantes() {
            try {
                const stats = await db.getStats();
                const container = document.getElementById('stats-representantes');
                
                let html = '';
                Object.entries(stats.por_representante).forEach(([rep, dados]) => {
                    const percentual = dados.total > 0 ? Math.round((dados.confirmados / dados.total) * 100) : 0;
                    
                    html += `
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">${rep}</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Total: ${dados.total}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Confirmados: ${dados.confirmados}</p>
                            <p class="text-sm font-semibold text-primary">${percentual}% de confirma√ß√£o</p>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error('Erro ao atualizar estat√≠sticas por representante:', error);
            }
        }

        async function exportarDados() {
            // (C√≥digo de exporta√ß√£o anterior mantido)
            showCustomAlert('üìä Fun√ß√£o de exporta√ß√£o mantida como anterior');
        }

        async function gerarRelatorioCompleto() {
            try {
                const stats = await db.getStats();
                const convidados = await db.select('convidados');
                
                let html = `
                    <div style="font-family: Arial; padding: 20px;">
                        <h1>üìà Relat√≥rio Completo do Sistema</h1>
                        <p><strong>Data de Gera√ß√£o:</strong> ${new Date().toLocaleString('pt-BR')}</p>
                        
                        <h2>üìä Estat√≠sticas Gerais</h2>
                        <ul>
                            <li>Total de Convidados: ${stats.total}</li>
                            <li>Confirmados: ${stats.confirmados}</li>
                            <li>Pendentes: ${stats.pendentes}</li>
                            <li>Taxa de Confirma√ß√£o: ${stats.taxa_confirmacao}%</li>
                        </ul>
                        
                        <h2>üë• Por Representante</h2>
                        <table border="1" style="border-collapse: collapse; width: 100%;">
                            <tr style="background: #f0f0f0;">
                                <th style="padding: 8px;">Representante</th>
                                <th style="padding: 8px;">Total</th>
                                <th style="padding: 8px;">Confirmados</th>
                                <th style="padding: 8px;">Taxa</th>
                            </tr>
                `;
                
                Object.entries(stats.por_representante).forEach(([rep, dados]) => {
                    const percentual = dados.total > 0 ? Math.round((dados.confirmados / dados.total) * 100) : 0;
                    html += `
                        <tr>
                            <td style="padding: 8px;">${rep}</td>
                            <td style="padding: 8px;">${dados.total}</td>
                            <td style="padding: 8px;">${dados.confirmados}</td>
                            <td style="padding: 8px;">${percentual}%</td>
                        </tr>
                    `;
                });
                
                html += '</table></div>';
                
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `relatorio_completo_${new Date().toISOString().split('T')[0]}.html`;
                a.click();
                URL.revokeObjectURL(url);
                
                showCustomAlert('üìà Relat√≥rio completo gerado com sucesso!');
            } catch (error) {
                showCustomAlert('‚ùå Erro ao gerar relat√≥rio: ' + error.message);
            }
        }

        async function alterarSenha() {
            const novaSenha = document.getElementById('nova-senha').value.trim();
            
            if (!novaSenha) {
                showCustomAlert('Por favor, digite uma nova senha');
                return;
            }
            
            if (novaSenha.length < 3) {
                showCustomAlert('A senha deve ter pelo menos 3 caracteres');
                return;
            }
            
            try {
                db.data.configuracoes.senha = novaSenha;
                document.getElementById('nova-senha').value = '';
                showCustomAlert('‚úÖ Senha alterada com sucesso!');
            } catch (error) {
                showCustomAlert('‚ùå Erro ao alterar senha: ' + error.message);
            }
        }

        // ==================== FUN√á√ïES DE UI PERSONALIZADAS ====================
        
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const voltarParaBusca = message.includes('Confirma√ß√£o de Convidados enviados aos noivos');
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="ok-btn px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded">OK</button>
                    </div>
                </div>
            `;
            
            const okBtn = modal.querySelector('.ok-btn');
            okBtn.addEventListener('click', () => {
                modal.remove();
                if (voltarParaBusca) {
                    mostrarPagina('busca');
                }
            });
            
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancelar</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Confirmar</button>
                    </div>
                </div>
            `;
            
            const cancelBtn = modal.querySelector('.cancel-btn');
            const confirmBtn = modal.querySelector('.confirm-btn');
            
            cancelBtn.addEventListener('click', () => modal.remove());
            confirmBtn.addEventListener('click', () => {
                modal.remove();
                if (onConfirm) onConfirm();
            });
            
            document.body.appendChild(modal);
        }

        function showPasswordDialog(paginaDestino) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100">üîí Acesso Restrito</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">Digite a senha para acessar esta p√°gina:</p>
                    <input type="password" id="password-input" placeholder="Digite a senha" class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700 mb-4">
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-pwd-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancelar</button>
                        <button class="access-btn px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded">Acessar</button>
                    </div>
                </div>
            `;
            
            const passwordInput = modal.querySelector('#password-input');
            const cancelBtn = modal.querySelector('.cancel-pwd-btn');
            const accessBtn = modal.querySelector('.access-btn');
            
            passwordInput.focus();
            
            cancelBtn.addEventListener('click', () => modal.remove());
            accessBtn.addEventListener('click', () => verificarSenha(paginaDestino, modal));
            passwordInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    verificarSenha(paginaDestino, modal);
                }
            });
            
            document.body.appendChild(modal);
        }

        function verificarSenha(paginaDestino, modal) {
            const senhaDigitada = modal.querySelector('#password-input').value;
            
            if (senhaDigitada === db.data.configuracoes.senha) {
                modal.remove();
                
                document.querySelectorAll('.page-content').forEach(page => {
                    page.classList.add('hidden');
                });
                
                document.getElementById(paginaDestino + '-page').classList.remove('hidden');
                
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('text-primary', 'font-semibold');
                    btn.classList.add('text-gray-500');
                });
                
                document.getElementById('nav-' + paginaDestino).classList.add('text-primary', 'font-semibold');
                document.getElementById('nav-' + paginaDestino).classList.remove('text-gray-500');
                
                paginaAtual = paginaDestino;
                
                if (paginaDestino === 'gerenciamento') {
                    atualizarTabelaPedidos();
                    atualizarEstatisticas();
                } else if (paginaDestino === 'relatorio') {
                    atualizarRelatorio();
                }
            } else {
                showCustomAlert('‚ùå Senha incorreta!');
            }
        }

        // ==================== EVENT LISTENERS E INICIALIZA√á√ÉO ====================
        
        document.getElementById('search-input').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                buscarConvidados();
            }
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', async function() {
            // Aguardar inicializa√ß√£o do banco de dados
            const maxAttempts = 10;
            let attempts = 0;
            
            const waitForDB = setInterval(async () => {
                if (db.initialized || attempts >= maxAttempts) {
                    clearInterval(waitForDB);
                    await atualizarEstatisticas();
                    
                    if (!db.initialized) {
                        showCustomAlert('‚ö†Ô∏è Sistema iniciado em modo offline. Algumas funcionalidades podem estar limitadas.');
                    }
                }
                attempts++;
            }, 500);
        });
    </script>
</body>
</html>
