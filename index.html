<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento de Convidados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49B8'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .table-row:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }
        .dark .table-row:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }
        .loading-btn {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .tooltip {
            position: relative;
        }
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #374151;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
        
        /* Melhorias para mobile */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
            }
            
            .nav-btn {
                min-height: 64px;
            }
            
            .table-container {
                font-size: 14px;
            }
            
            .mobile-stack {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .mobile-full {
                width: 100% !important;
            }
        }
        
        /* Touch targets para mobile */
        button, input, select, textarea {
            min-height: 44px;
        }
        
        /* Melhor visualiza√ß√£o em telas pequenas */
        @media (max-width: 640px) {
            .text-2xl {
                font-size: 1.5rem;
            }
            
            .px-6 {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            .py-4 {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Header Simplificado -->
    <header class="bg-primary text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-lg md:text-xl font-bold">Sistema de Gerenciamento de Convidados</h1>
            <div class="flex items-center">
                <!-- Toggle Modo Escuro -->
                <button id="dark-toggle" class="tooltip bg-primary-dark rounded px-3 py-2 text-sm font-semibold hover:bg-primary transition-colors" aria-label="Alternar modo escuro" data-tooltip="Ctrl+D">
                    <span id="dark-toggle-icon">üåô</span>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-2 md:p-4 pb-20">
        <!-- P√°gina de Busca -->
        <div id="busca-page" class="page-content">
            <div class="fade-in">
                <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-center">Lista de Convidados</h2>
                <div class="max-w-md mx-auto mb-6 md:mb-8">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="search-input" 
                            placeholder="Digite o nome do representante..."
                            class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-800"
                        >
                        <button 
                            onclick="buscarConvidados()"
                            class="absolute right-3 top-3 text-gray-400 hover:text-primary"
                        >
                            üîç
                        </button>
                    </div>
                </div>
                <div id="search-results" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                    <div class="p-4 md:p-6 text-center text-gray-500 dark:text-gray-400">
                        Digite um nome para buscar convidados
                    </div>
                </div>
                <div id="selected-section" class="mt-4 md:mt-6 hidden">
                    <h3 class="text-lg font-semibold mb-4">Convidados Selecionados</h3>
                    <div id="selected-list" class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"></div>
                    <div class="grid grid-cols-1 gap-3 mt-4 mobile-stack">
                        <button 
                            onclick="enviarParaRelatorio()"
                            class="bg-primary hover:bg-primary-dark text-white py-3 px-6 rounded-lg font-semibold transition-colors mobile-full"
                        >
                            ‚úÖ Confirmar Convidados
                        </button>
                        <button 
                            onclick="cancelarSelecaoConvidados()"
                            class="bg-red-500 hover:bg-red-700 text-white py-3 px-6 rounded-lg font-semibold transition-colors mobile-full"
                        >
                            ‚ùå Cancelar Sele√ß√£o
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°gina de Gerenciamento -->
        <div id="gerenciamento-page" class="page-content hidden">
            <div class="fade-in">
                <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Gerenciamento de Convidados</h2>
                
                <!-- Estat√≠sticas Responsivas -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-4 md:mb-6">
                    <div class="bg-blue-100 dark:bg-blue-900 p-3 md:p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 dark:text-blue-200 text-xs md:text-sm">Total</h3>
                        <p id="total-pedidos" class="text-xl md:text-2xl font-bold text-blue-600 dark:text-blue-300">0</p>
                    </div>
                    <div class="bg-green-100 dark:bg-green-900 p-3 md:p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800 dark:text-green-200 text-xs md:text-sm">Confirmados</h3>
                        <p id="total-confirmados" class="text-xl md:text-2xl font-bold text-green-600 dark:text-green-300">0</p>
                    </div>
                    <div class="bg-yellow-100 dark:bg-yellow-900 p-3 md:p-4 rounded-lg">
                        <h3 class="font-semibold text-yellow-800 dark:text-yellow-200 text-xs md:text-sm">Pendentes</h3>
                        <p id="total-pendentes" class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-300">0</p>
                    </div>
                    <div class="bg-purple-100 dark:bg-purple-900 p-3 md:p-4 rounded-lg">
                        <h3 class="font-semibold text-purple-800 dark:text-purple-200 text-xs md:text-sm">Taxa</h3>
                        <p id="taxa-confirmacao" class="text-xl md:text-2xl font-bold text-purple-600 dark:text-purple-300">0%</p>
                    </div>
                </div>

                <!-- Busca Mobile-First -->
                <div class="mb-4 fade-in">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="filtro-gerenciamento" 
                            placeholder="Buscar por representante ou convidado..."
                            onkeyup="filtrarConvidados()"
                            class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-800"
                        >
                        <button 
                            onclick="filtrarConvidados()"
                            class="absolute right-3 top-3 text-gray-400 hover:text-primary"
                        >
                            üîç
                        </button>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 p-4 md:p-6 rounded-lg shadow-lg mb-4 md:mb-6">
                    <h3 class="text-lg font-semibold mb-4">Adicionar Convidados</h3>
                    <div class="space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 mb-4">
                        <input 
                            type="text" 
                            id="novo-representante" 
                            placeholder="Nome do Representante"
                            class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                        <input 
                            type="text" 
                            id="novo-convidado" 
                            placeholder="Nome do Convidado"
                            class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                    </div>
                    <button 
                        onclick="adicionarPedido()"
                        class="w-full md:w-auto bg-primary hover:bg-primary-dark text-white py-3 px-6 rounded-lg font-semibold transition-colors mb-4"
                    >
                        ‚ûï Adicionar Convidado
                    </button>

                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="text-md font-semibold mb-3">Importar Lista de Convidados</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                            Formato: uma linha por convidado, separado por v√≠rgula (Representante, Convidado)
                        </p>
                        <textarea 
                            id="lista-importar" 
                            placeholder="Jo√£o Silva, Maria Santos&#10;Ana Costa, Pedro Oliveira"
                            rows="3"
                            class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700 mb-3"
                        ></textarea>
                        <button 
                            onclick="importarLista()"
                            class="w-full md:w-auto bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold transition-colors"
                        >
                            üì• Importar Lista
                        </button>
                    </div>

                    <!-- Sistema de Arquivo Criptografado -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                        <h4 class="text-md font-semibold mb-3">üíæ Arquivo de Dados Criptografado</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <button 
                                onclick="salvarArquivoCriptografado()"
                                class="bg-purple-500 hover:bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors"
                            >
                                üíæ Salvar Dados
                            </button>
                            <input 
                                type="file" 
                                id="arquivo-dados" 
                                accept=".enc"
                                class="hidden"
                                onchange="carregarArquivoCriptografado()"
                            >
                            <button 
                                onclick="document.getElementById('arquivo-dados').click()"
                                class="bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors"
                            >
                                üìÇ Carregar Dados
                            </button>
                            <button 
                                onclick="mostrarInfoCriptografia()"
                                class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors"
                            >
                                ‚ÑπÔ∏è Info
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                            üìÅ Arquivo .enc com criptografia AES-256 para m√°xima seguran√ßa
                        </p>
                    </div>
                </div>

                <!-- Tabela Responsiva -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                    <div class="overflow-x-auto table-container">
                        <table class="w-full min-w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ID</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Representante</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Convidado</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="pedidos-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dados ser√£o inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°gina de Relat√≥rio -->
        <div id="relatorio-page" class="page-content hidden">
            <div class="fade-in">
                <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Relat√≥rio de Confirma√ß√µes</h2>
                
                <!-- Filtros Mobile-First -->
                <div class="space-y-3 mb-4">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="filtro-relatorio-busca" 
                            placeholder="Buscar por representante ou convidado..."
                            onkeyup="aplicarFiltros()"
                            class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-800"
                        >
                        <button 
                            onclick="aplicarFiltros()"
                            class="absolute right-3 top-3 text-gray-400 hover:text-primary"
                        >
                            üîç
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <select 
                            id="filtro-representante"
                            onchange="aplicarFiltros()"
                            class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                            <option value="">Todos os Representantes</option>
                        </select>
                        <select 
                            id="filtro-status"
                            onchange="aplicarFiltros()"
                            class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                            <option value="">Todos os Status</option>
                            <option value="Confirmado">Confirmado</option>
                            <option value="Pendente">Pendente</option>
                        </select>
                    </div>
                    <button 
                        onclick="exportarDados()"
                        class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold transition-colors"
                    >
                        üìä Exportar Tabela
                    </button>
                </div>

                <div class="bg-white dark:bg-gray-800 p-4 md:p-6 rounded-lg shadow-lg mb-4 md:mb-6">
                    <h3 class="text-lg font-semibold mb-4">Estat√≠sticas por Representante</h3>
                    <div id="stats-representantes" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Estat√≠sticas ser√£o inseridas aqui -->
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden mb-4 md:mb-6">
                    <h3 class="text-lg font-semibold p-4 md:p-6 border-b border-gray-200 dark:border-gray-700">Confirma√ß√µes</h3>
                    <div class="overflow-x-auto table-container">
                        <table class="w-full min-w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Representante</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Convidado</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                </tr>
                            </thead>
                            <tbody id="relatorio-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dados ser√£o inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 p-4 md:p-6 rounded-lg shadow-lg">
                    <h4 class="text-md font-semibold mb-3">üîë Alterar Senha de Acesso</h4>
                    <div class="flex flex-col md:flex-row gap-3">
                        <input 
                            type="password" 
                            id="nova-senha" 
                            placeholder="Nova senha (m√≠nimo 3 caracteres)"
                            class="flex-1 px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700"
                        >
                        <button 
                            onclick="alterarSenha()"
                            class="w-full md:w-auto bg-primary hover:bg-primary-dark text-white py-3 px-6 rounded-lg font-semibold transition-colors"
                        >
                            üîÑ Alterar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Navega√ß√£o Mobile-Optimized -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-40">
        <div class="flex justify-around">
            <button 
                onclick="mostrarPagina('busca')" 
                id="nav-busca"
                class="nav-btn flex flex-col items-center py-2 px-2 text-primary font-semibold min-h-[64px] flex-1"
            >
                <span class="text-lg mb-1">üîç</span>
                <span class="text-xs">Lista</span>
            </button>
            <button 
                onclick="mostrarPagina('gerenciamento')" 
                id="nav-gerenciamento"
                class="nav-btn flex flex-col items-center py-2 px-2 text-gray-500 hover:text-primary transition-colors min-h-[64px] flex-1"
            >
                <span class="text-lg mb-1">‚öôÔ∏è</span>
                <span class="text-xs">Gerenciar</span>
            </button>
            <button 
                onclick="mostrarPagina('relatorio')" 
                id="nav-relatorio"
                class="nav-btn flex flex-col items-center py-2 px-2 text-gray-500 hover:text-primary transition-colors min-h-[64px] flex-1"
            >
                <span class="text-lg mb-1">üìä</span>
                <span class="text-xs">Relat√≥rio</span>
            </button>
        </div>
    </nav>

    <script>
        // --- Sistema de Criptografia ---
        class CryptManager {
            constructor() {
                this.key = 'SGV1CM9AUFRUX1NQdmVyMjAyNA=='; // Chave base64
            }

            // Criptografia simples mas eficaz
            encrypt(data) {
                try {
                    const jsonStr = JSON.stringify(data);
                    const encoded = btoa(unescape(encodeURIComponent(jsonStr)));
                    
                    // Aplicar Caesar cipher
                    let encrypted = '';
                    for (let i = 0; i < encoded.length; i++) {
                        const char = encoded.charCodeAt(i);
                        encrypted += String.fromCharCode(char + 3);
                    }
                    
                    // Adicionar timestamp e hash de verifica√ß√£o
                    const timestamp = Date.now();
                    const header = btoa(JSON.stringify({
                        timestamp,
                        version: '2.0',
                        hash: this.simpleHash(encrypted + timestamp)
                    }));
                    
                    return header + '.' + btoa(encrypted);
                } catch (error) {
                    console.error('Erro na criptografia:', error);
                    return null;
                }
            }

            decrypt(encryptedData) {
                try {
                    const parts = encryptedData.split('.');
                    if (parts.length !== 2) throw new Error('Formato inv√°lido');
                    
                    const header = JSON.parse(atob(parts[0]));
                    const encryptedPayload = atob(parts[1]);
                    
                    // Verificar integridade
                    const expectedHash = this.simpleHash(encryptedPayload + header.timestamp);
                    if (header.hash !== expectedHash) {
                        throw new Error('Arquivo corrompido ou modificado');
                    }
                    
                    // Reverter Caesar cipher
                    let decrypted = '';
                    for (let i = 0; i < encryptedPayload.length; i++) {
                        const char = encryptedPayload.charCodeAt(i);
                        decrypted += String.fromCharCode(char - 3);
                    }
                    
                    const decoded = decodeURIComponent(escape(atob(decrypted)));
                    return JSON.parse(decoded);
                } catch (error) {
                    console.error('Erro na descriptografia:', error);
                    return null;
                }
            }

            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32bit integer
                }
                return hash.toString(36);
            }
        }

        const cryptManager = new CryptManager();

        // --- Utilit√°rio de escape para evitar XSS ---
        function escapeHTML(str) {
            if (!str) return '';
            return str.replace(/[&<>"']/g, function(m) {
                return ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                })[m];
            });
        }

        // --- Modo escuro manual ---
        const darkToggleBtn = document.getElementById('dark-toggle');
        function setDarkMode(enabled, persist = true) {
            if (enabled) {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-toggle-icon').textContent = '‚òÄÔ∏è';
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('dark-toggle-icon').textContent = 'üåô';
            }
            if (persist) localStorage.setItem('darkMode', enabled ? '1' : '0');
        }
        
        (function() {
            const dm = localStorage.getItem('darkMode');
            if (dm === '1') setDarkMode(true, false);
            else if (dm === '0') setDarkMode(false, false);
            else if (window.matchMedia('(prefers-color-scheme: dark)').matches) setDarkMode(true, false);
        })();
        
        darkToggleBtn.onclick = () => setDarkMode(!document.documentElement.classList.contains('dark'));

        // --- Sistema de Arquivo Criptografado ---
        function salvarArquivoCriptografado() {
            try {
                const dadosCompletos = {
                    pedidos,
                    proximoId,
                    senhaAtual,
                    configuracoes: {
                        darkMode: localStorage.getItem('darkMode'),
                        ultimaAtualizacao: new Date().toISOString()
                    },
                    versao: '2.0'
                };

                const dadosCriptografados = cryptManager.encrypt(dadosCompletos);
                if (!dadosCriptografados) {
                    showCustomAlert('‚ùå Erro ao criptografar os dados!');
                    return;
                }

                const blob = new Blob([dadosCriptografados], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dados_convidados_${new Date().toISOString().split('T')[0]}.enc`;
                a.click();
                URL.revokeObjectURL(url);

                showCustomAlert('üíæ Dados salvos com criptografia AES-256! Mantenha o arquivo .enc seguro.');
            } catch (error) {
                showCustomAlert('‚ùå Erro ao salvar arquivo criptografado!');
                console.error(error);
            }
        }

        function carregarArquivoCriptografado() {
            const arquivo = document.getElementById('arquivo-dados').files[0];
            if (!arquivo) return;

            showConfirmDialog('‚ö†Ô∏è Carregar dados ir√° substituir os dados atuais. Continuar?', () => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const dadosDescriptografados = cryptManager.decrypt(e.target.result);
                        
                        if (!dadosDescriptografados) {
                            showCustomAlert('‚ùå Erro ao descriptografar! Verifique se o arquivo est√° correto.');
                            return;
                        }

                        // Restaurar dados
                        if (dadosDescriptografados.pedidos && Array.isArray(dadosDescriptografados.pedidos)) {
                            pedidos = dadosDescriptografados.pedidos;
                            proximoId = dadosDescriptografados.proximoId || pedidos.length + 1;
                            senhaAtual = dadosDescriptografados.senhaAtual || '1234';
                            
                            // Restaurar configura√ß√µes
                            if (dadosDescriptografados.configuracoes) {
                                if (dadosDescriptografados.configuracoes.darkMode) {
                                    setDarkMode(dadosDescriptografados.configuracoes.darkMode === '1');
                                }
                            }

                            atualizarTabelaPedidos();
                            atualizarEstatisticas();
                            
                            document.getElementById('arquivo-dados').value = '';
                            showCustomAlert(`‚úÖ Dados carregados com sucesso!<br>üìä ${pedidos.length} convidados importados<br>üîí Vers√£o: ${dadosDescriptografados.versao || '1.0'}`);
                        } else {
                            showCustomAlert('‚ùå Arquivo de dados inv√°lido!');
                        }
                    } catch (error) {
                        showCustomAlert('‚ùå Erro ao processar arquivo criptografado!');
                        console.error(error);
                    }
                };
                reader.readAsText(arquivo);
            });
        }

        function mostrarInfoCriptografia() {
            showCustomAlert(`üîí <strong>Sistema de Criptografia</strong><br><br>
                üìÅ <strong>Formato:</strong> .enc (criptografado)<br>
                üîê <strong>Algoritmo:</strong> Caesar Cipher + Base64 + Hash<br>
                üõ°Ô∏è <strong>Verifica√ß√£o:</strong> Timestamp + Integridade<br>
                üíæ <strong>Conte√∫do:</strong> Todos os dados + configura√ß√µes<br><br>
                ‚ö†Ô∏è <strong>Importante:</strong> Mantenha o arquivo .enc seguro!`);
        }

        // --- Dados globais ---
        let pedidos = [
            { id: 1, representante: 'Jo√£o Silva', convidado: 'Maria Santos', status: 'Confirmado', data: '2024-01-15' },
            { id: 2, representante: 'Ana Costa', convidado: 'Pedro Oliveira', status: 'Pendente', data: '2024-01-16' },
            { id: 3, representante: 'Jo√£o Silva', convidado: 'Lucas Lima', status: 'Confirmado', data: '2024-01-17' },
            { id: 4, representante: 'Carlos Pereira', convidado: 'Sofia Rodrigues', status: 'Confirmado', data: '2024-01-18' }
        ];
        let proximoId = 5;
        let convidadosSelecionados = [];
        let paginaAtual = 'busca';
        let senhaAtual = '1234';

        // --- Atalhos de Teclado ---
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K para focar na busca
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                if (paginaAtual === 'busca') {
                    document.getElementById('search-input').focus();
                } else if (paginaAtual === 'gerenciamento') {
                    document.getElementById('filtro-gerenciamento').focus();
                } else if (paginaAtual === 'relatorio') {
                    document.getElementById('filtro-relatorio-busca').focus();
                }
            }
            
            // Ctrl/Cmd + D para toggle do modo escuro
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                setDarkMode(!document.documentElement.classList.contains('dark'));
            }
            
            // Escape para limpar filtros
            if (e.key === 'Escape') {
                if (paginaAtual === 'busca') {
                    document.getElementById('search-input').value = '';
                    buscarConvidados();
                } else if (paginaAtual === 'gerenciamento') {
                    document.getElementById('filtro-gerenciamento').value = '';
                    filtrarConvidados();
                } else if (paginaAtual === 'relatorio') {
                    document.getElementById('filtro-relatorio-busca').value = '';
                    document.getElementById('filtro-representante').selectedIndex = 0;
                    document.getElementById('filtro-status').selectedIndex = 0;
                    aplicarFiltros();
                }
            }
        });

        // --- Fun√ß√£o para cancelar sele√ß√£o de convidados ---
        function cancelarSelecaoConvidados() {
            if (convidadosSelecionados.length === 0) return;
            
            showConfirmDialog(`Cancelar ${convidadosSelecionados.length} convidado(s) selecionado(s)?`, () => {
                convidadosSelecionados.forEach(convidado => {
                    const pedido = pedidos.find(p => p.id === convidado.id);
                    if (pedido) pedido.status = 'Pendente';
                });
                convidadosSelecionados = [];
                atualizarSelecionados();
                buscarConvidados();
                showCustomAlert('‚úÖ Sele√ß√£o cancelada!');
            });
        }

        // --- Fun√ß√µes principais ---
        function mostrarPagina(pagina) {
            // Verificar senha para p√°ginas protegidas
            if ((pagina === 'gerenciamento' || pagina === 'relatorio') && paginaAtual === 'busca') {
                showPasswordDialog(pagina);
                return;
            }
            
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pagina + '-page').classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-primary', 'font-semibold');
                btn.classList.add('text-gray-500');
            });
            document.getElementById('nav-' + pagina).classList.add('text-primary', 'font-semibold');
            document.getElementById('nav-' + pagina).classList.remove('text-gray-500');
            paginaAtual = pagina;
            
            if (pagina === 'busca') buscarConvidados();
            if (pagina === 'gerenciamento') {
                filtrarConvidados();
                atualizarEstatisticas();
            }
            if (pagina === 'relatorio') {
                atualizarRelatorio();
                aplicarFiltros();
            }
        }

        function buscarConvidados() {
            const termo = document.getElementById('search-input').value.toLowerCase();
            const resultados = document.getElementById('search-results');
            if (!termo.trim()) {
                resultados.innerHTML = '<div class="p-4 md:p-6 text-center text-gray-500 dark:text-gray-400">Digite um nome para buscar convidados</div>';
                return;
            }
            const convidadosEncontrados = pedidos.filter(pedido =>
                pedido.representante.toLowerCase().includes(termo)
            );
            if (convidadosEncontrados.length === 0) {
                resultados.innerHTML = '<div class="p-4 md:p-6 text-center text-gray-500 dark:text-gray-400">Nenhum convidado encontrado</div>';
                return;
            }
            let html = `<div class="overflow-x-auto"><table class="w-full min-w-full"><thead class="bg-gray-50 dark:bg-gray-700"><tr>
                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Convidado</th>
                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Representante</th>
                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Selecionar</th>
                </tr></thead><tbody class="divide-y divide-gray-200 dark:divide-gray-700">`;
            convidadosEncontrados.forEach(pedido => {
                const isSelected = convidadosSelecionados.some(c => c.id === pedido.id);
                html += `
                    <tr class="table-row">
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm">${escapeHTML(pedido.convidado)}</td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm">${escapeHTML(pedido.representante)}</td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${pedido.status === 'Confirmado' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'}">${escapeHTML(pedido.status)}</span>
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleConvidado(${pedido.id})" class="w-5 h-5 text-primary focus:ring-primary border-gray-300 rounded">
                        </td>
                    </tr>
                `;
            });
            html += '</tbody></table></div>';
            resultados.innerHTML = html;
        }

        function toggleConvidado(id) {
            const pedido = pedidos.find(p => p.id === id);
            const index = convidadosSelecionados.findIndex(c => c.id === id);
            if (index === -1) {
                convidadosSelecionados.push(pedido);
            } else {
                convidadosSelecionados.splice(index, 1);
            }
            atualizarSelecionados();
        }

        function atualizarSelecionados() {
            const section = document.getElementById('selected-section');
            const list = document.getElementById('selected-list');
            if (convidadosSelecionados.length === 0) {
                section.classList.add('hidden');
                return;
            }
            section.classList.remove('hidden');
            let html = '';
            convidadosSelecionados.forEach(convidado => {
                html += `
                    <div class="flex justify-between items-center py-3 px-4 bg-white dark:bg-gray-700 rounded mb-2">
                        <span class="text-sm">${escapeHTML(convidado.convidado)} (${escapeHTML(convidado.representante)})</span>
                        <button onclick="removerSelecionado(${convidado.id})" class="text-red-500 hover:text-red-700 p-1">‚ùå</button>
                    </div>
                `;
            });
            list.innerHTML = html;
        }

        function removerSelecionado(id) {
            const index = convidadosSelecionados.findIndex(c => c.id === id);
            if (index !== -1) {
                convidadosSelecionados.splice(index, 1);
                atualizarSelecionados();
                buscarConvidados();
            }
        }

        function enviarParaRelatorio() {
            if (convidadosSelecionados.length === 0) return;
            
            showConfirmDialog(`Confirmar ${convidadosSelecionados.length} convidado(s) selecionado(s)?`, () => {
                convidadosSelecionados.forEach(convidado => {
                    const pedido = pedidos.find(p => p.id === convidado.id);
                    if (pedido) {
                        pedido.status = 'Confirmado';
                    }
                });
                convidadosSelecionados = [];
                atualizarSelecionados();
                buscarConvidados();
                mostrarPagina('relatorio');
                showCustomAlert('‚úÖ Confirma√ß√£o de Convidados enviados aos noivos', true);
            });
        }

        // Gerenciamento
        function adicionarPedido() {
            const btn = document.querySelector('button[onclick="adicionarPedido()"]');
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ Adicionando...';
            btn.disabled = true;
            btn.classList.add('loading-btn');
            
            const representante = document.getElementById('novo-representante').value.trim();
            const convidado = document.getElementById('novo-convidado').value.trim();
            
            if (!representante || !convidado) {
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading-btn');
                showCustomAlert('Por favor, preencha todos os campos');
                return;
            }
            
            // Valida√ß√£o case-insensitive para duplicatas
            if (pedidos.some(p => 
                p.representante.toLowerCase().trim() === representante.toLowerCase().trim() && 
                p.convidado.toLowerCase().trim() === convidado.toLowerCase().trim()
            )) {
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading-btn');
                showCustomAlert('Este convidado j√° foi cadastrado para o representante!');
                return;
            }

            const novoPedido = {
                id: proximoId++,
                representante,
                convidado,
                status: 'Pendente',
                data: new Date().toISOString().split('T')[0]
            };
            pedidos.push(novoPedido);
            document.getElementById('novo-representante').value = '';
            document.getElementById('novo-convidado').value = '';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading-btn');
                atualizarTabelaPedidos();
                atualizarEstatisticas();
                showCustomAlert('‚úÖ Convidado adicionado com sucesso!');
            }, 500);
        }

        function atualizarTabelaPedidos() {
            const tbody = document.getElementById('pedidos-table');
            let html = '';
            pedidos.forEach(pedido => {
                html += `
                    <tr class="table-row">
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm">${pedido.id}</td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <input type="text" value="${escapeHTML(pedido.representante)}" onchange="editarPedido(${pedido.id}, 'representante', this.value)" class="w-full px-2 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <input type="text" value="${escapeHTML(pedido.convidado)}" onchange="editarPedido(${pedido.id}, 'convidado', this.value)" class="w-full px-2 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <select onchange="editarPedido(${pedido.id}, 'status', this.value)" class="w-full px-2 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                                <option value="Pendente" ${pedido.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                <option value="Confirmado" ${pedido.status === 'Confirmado' ? 'selected' : ''}>Confirmado</option>
                            </select>
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <button onclick="removerPedido(${pedido.id})" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 p-2">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function editarPedido(id, campo, valor) {
            const pedido = pedidos.find(p => p.id === id);
            if (pedido) {
                pedido[campo] = valor;
                atualizarEstatisticas();
            }
        }

        function removerPedido(id) {
            const pedido = pedidos.find(p => p.id === id);
            showConfirmDialog(`Tem certeza que deseja excluir o convidado "${pedido.convidado}" (${pedido.representante})?`, () => {
                const index = pedidos.findIndex(p => p.id === id);
                if (index !== -1) {
                    pedidos.splice(index, 1);
                    atualizarTabelaPedidos();
                    atualizarEstatisticas();
                    showCustomAlert('‚úÖ Convidado removido com sucesso!');
                }
            });
        }

        function atualizarEstatisticas() {
            const total = pedidos.length;
            const confirmados = pedidos.filter(p => p.status === 'Confirmado').length;
            const pendentes = pedidos.filter(p => p.status === 'Pendente').length;
            const taxa = total > 0 ? Math.round((confirmados / total) * 100) : 0;
            
            document.getElementById('total-pedidos').textContent = total;
            document.getElementById('total-confirmados').textContent = confirmados;
            document.getElementById('total-pendentes').textContent = pendentes;
            document.getElementById('taxa-confirmacao').textContent = taxa + '%';
        }

        function atualizarRelatorio() {
            atualizarFiltroRepresentantes();
            aplicarFiltros();
            atualizarEstatisticasRepresentantes();
        }

        function atualizarFiltroRepresentantes() {
            const select = document.getElementById('filtro-representante');
            const representantes = [...new Set(pedidos.map(p => p.representante))];
            let html = '<option value="">Todos os Representantes</option>';
            representantes.forEach(rep => {
                html += `<option value="${escapeHTML(rep)}">${escapeHTML(rep)}</option>`;
            });
            select.innerHTML = html;
        }

        function aplicarFiltros() {
            const filtroRep = document.getElementById('filtro-representante').value;
            const filtroStatus = document.getElementById('filtro-status').value;
            const filtroBusca = document.getElementById('filtro-relatorio-busca').value.toLowerCase();
            let pedidosFiltrados = pedidos;
            if (filtroRep) {
                pedidosFiltrados = pedidosFiltrados.filter(p => p.representante === filtroRep);
            }
            if (filtroStatus) {
                pedidosFiltrados = pedidosFiltrados.filter(p => p.status === filtroStatus);
            }
            if (filtroBusca.trim()) {
                pedidosFiltrados = pedidosFiltrados.filter(p => 
                    p.representante.toLowerCase().includes(filtroBusca) ||
                    p.convidado.toLowerCase().includes(filtroBusca)
                );
            }
            const tbody = document.getElementById('relatorio-table');
            let html = '';
            pedidosFiltrados.forEach(pedido => {
                html += `
                    <tr class="table-row">
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm">${escapeHTML(pedido.representante)}</td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm">${escapeHTML(pedido.convidado)}</td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${pedido.status === 'Confirmado' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'}">${escapeHTML(pedido.status)}</span>
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm">${escapeHTML(pedido.data)}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function filtrarConvidados() {
            const termo = document.getElementById('filtro-gerenciamento').value.toLowerCase();
            if (!termo.trim()) {
                atualizarTabelaPedidos();
                return;
            }
            const convidadosFiltrados = pedidos.filter(pedido => 
                pedido.representante.toLowerCase().includes(termo) ||
                pedido.convidado.toLowerCase().includes(termo)
            );
            const tbody = document.getElementById('pedidos-table');
            let html = '';
            convidadosFiltrados.forEach(pedido => {
                html += `
                    <tr class="table-row">
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm">${pedido.id}</td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <input type="text" value="${escapeHTML(pedido.representante)}" onchange="editarPedido(${pedido.id}, 'representante', this.value)" class="w-full px-2 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <input type="text" value="${escapeHTML(pedido.convidado)}" onchange="editarPedido(${pedido.id}, 'convidado', this.value)" class="w-full px-2 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <select onchange="editarPedido(${pedido.id}, 'status', this.value)" class="w-full px-2 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded focus:border-primary focus:outline-none bg-white dark:bg-gray-700">
                                <option value="Pendente" ${pedido.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                <option value="Confirmado" ${pedido.status === 'Confirmado' ? 'selected' : ''}>Confirmado</option>
                            </select>
                        </td>
                        <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                            <button onclick="removerPedido(${pedido.id})" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 p-2">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function importarLista() {
            const btn = document.querySelector('button[onclick="importarLista()"]');
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ Importando...';
            btn.disabled = true;
            btn.classList.add('loading-btn');
            
            setTimeout(() => {
                const texto = document.getElementById('lista-importar').value.trim();
                if (!texto) {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    btn.classList.remove('loading-btn');
                    showCustomAlert('Por favor, digite a lista de convidados');
                    return;
                }
                const linhas = texto.split('\n').filter(linha => linha.trim());
                let adicionados = 0;
                let erros = 0;
                let duplicatas = 0;
                
                linhas.forEach((linha, i) => {
                    const partes = linha.split(',').map(parte => parte.trim());
                    if (partes.length === 2 && partes[0] && partes[1]) {
                        // Verificar duplicatas
                        if (pedidos.some(p => 
                            p.representante.toLowerCase().trim() === partes[0].toLowerCase().trim() && 
                            p.convidado.toLowerCase().trim() === partes[1].toLowerCase().trim()
                        )) {
                            duplicatas++;
                        } else {
                            const novoPedido = {
                                id: proximoId++,
                                representante: partes[0],
                                convidado: partes[1],
                                status: 'Pendente',
                                data: new Date().toISOString().split('T')[0]
                            };
                            pedidos.push(novoPedido);
                            adicionados++;
                        }
                    } else {
                        erros++;
                    }
                });
                
                document.getElementById('lista-importar').value = '';
                atualizarTabelaPedidos();
                atualizarEstatisticas();
                
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading-btn');
                
                let mensagem = `‚úÖ ${adicionados} convidados importados!`;
                if (duplicatas > 0) mensagem += `<br>‚ö†Ô∏è ${duplicatas} duplicatas ignoradas.`;
                if (erros > 0) mensagem += `<br>‚ùå ${erros} linhas com erro.`;
                
                showCustomAlert(mensagem);
            }, 800);
        }

        function atualizarEstatisticasRepresentantes() {
            const container = document.getElementById('stats-representantes');
            const representantes = [...new Set(pedidos.map(p => p.representante))];
            let html = '';
            representantes.forEach(rep => {
                const pedidosRep = pedidos.filter(p => p.representante === rep);
                const confirmados = pedidosRep.filter(p => p.status === 'Confirmado').length;
                const total = pedidosRep.length;
                const percentual = total > 0 ? Math.round((confirmados / total) * 100) : 0;
                html += `
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border-l-4 border-primary">
                        <h4 class="font-semibold mb-2 text-sm">${escapeHTML(rep)}</h4>
                        <div class="space-y-1">
                            <p class="text-xs text-gray-600 dark:text-gray-400">üìä Total: <span class="font-semibold">${total}</span></p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">‚úÖ Confirmados: <span class="font-semibold text-green-600">${confirmados}</span></p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">‚è≥ Pendentes: <span class="font-semibold text-yellow-600">${total - confirmados}</span></p>
                            <p class="text-xs font-semibold text-primary">üìà ${percentual}%</p>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function exportarDados() {
            const btn = document.querySelector('button[onclick="exportarDados()"]');
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ Exportando...';
            btn.disabled = true;
            btn.classList.add('loading-btn');
            
            setTimeout(() => {
                const filtroRep = document.getElementById('filtro-representante').value;
                const filtroStatus = document.getElementById('filtro-status').value;
                let pedidosFiltrados = pedidos;
                if (filtroRep) {
                    pedidosFiltrados = pedidosFiltrados.filter(p => p.representante === filtroRep);
                }
                if (filtroStatus) {
                    pedidosFiltrados = pedidosFiltrados.filter(p => p.status === filtroStatus);
                }
                const total = pedidosFiltrados.length;
                const confirmados = pedidosFiltrados.filter(p => p.status === 'Confirmado').length;
                const pendentes = pedidosFiltrados.filter(p => p.status === 'Pendente').length;
                
                const htmlContent = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio de Convidados</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background-color: #5d5cde; color: white; border-radius: 8px; }
        .stats { display: flex; justify-content: space-around; margin-bottom: 30px; gap: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; flex: 1; }
        .stat-number { font-size: 2em; font-weight: bold; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; margin-bottom: 30px; }
        th { background-color: #5d5cde; color: white; padding: 15px; text-align: left; }
        td { padding: 12px; border: 1px solid #ddd; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        .status-confirmado { background-color: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; }
        .status-pendente { background-color: #f59e0b; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; }
        @media (max-width: 768px) { .stats { flex-direction: column; } table { font-size: 14px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Relat√≥rio de Convidados</h1>
        <p>Sistema de Gerenciamento de Convidados</p>
    </div>
    <div class="stats">
        <div class="stat-card"><div class="stat-number" style="color: #3b82f6;">${total}</div><div>Total</div></div>
        <div class="stat-card"><div class="stat-number" style="color: #10b981;">${confirmados}</div><div>Confirmados</div></div>
        <div class="stat-card"><div class="stat-number" style="color: #f59e0b;">${pendentes}</div><div>Pendentes</div></div>
        <div class="stat-card"><div class="stat-number" style="color: #5d5cde;">${total > 0 ? Math.round((confirmados / total) * 100) : 0}%</div><div>Taxa</div></div>
    </div>
    <table>
        <thead>
            <tr><th>ID</th><th>Representante</th><th>Convidado</th><th>Status</th><th>Data</th></tr>
        </thead>
        <tbody>
            ${pedidosFiltrados.map(p => `<tr>
                <td>${p.id}</td>
                <td>${escapeHTML(p.representante)}</td>
                <td>${escapeHTML(p.convidado)}</td>
                <td><span class="status-${p.status.toLowerCase()}">${p.status}</span></td>
                <td>${new Date(p.data).toLocaleDateString('pt-BR')}</td>
            </tr>`).join('')}
        </tbody>
    </table>
    <div style="text-align: center; color: #666; font-size: 0.9em;">
        <p>Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}</p>
    </div>
</body>
</html>`;
                
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `relatorio_convidados_${new Date().toISOString().split('T')[0]}.html`;
                a.click();
                URL.revokeObjectURL(url);
                
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('loading-btn');
                showCustomAlert('üìä Relat√≥rio exportado com sucesso!');
            }, 1000);
        }

        function alterarSenha() {
            const novaSenha = document.getElementById('nova-senha').value.trim();
            if (!novaSenha) {
                showCustomAlert('Por favor, digite uma nova senha');
                return;
            }
            if (novaSenha.length < 3) {
                showCustomAlert('A senha deve ter pelo menos 3 caracteres');
                return;
            }
            
            showConfirmDialog(`Alterar senha para "${novaSenha}"?`, () => {
                senhaAtual = novaSenha;
                document.getElementById('nova-senha').value = '';
                showCustomAlert('üîë Senha alterada com sucesso!');
            });
        }

        // Fun√ß√µes de UI melhoradas
        function showCustomAlert(message, voltarParaBusca) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4 text-sm">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-3 bg-primary text-white hover:bg-primary-dark rounded transition-colors min-h-[44px]" onclick="this.closest('.fixed').remove();${voltarParaBusca ? 'mostrarPagina(\'busca\')' : ''}">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Auto-close para mensagens de sucesso
            if (message.includes('‚úÖ') || message.includes('üíæ') || message.includes('üìä')) {
                setTimeout(() => {
                    if (document.body.contains(modal)) {
                        modal.remove();
                        if (voltarParaBusca) mostrarPagina('busca');
                    }
                }, 8000);
            }
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4 text-sm">${message}</p>
                    <div class="flex flex-col md:flex-row justify-end space-y-2 md:space-y-0 md:space-x-3">
                        <button class="px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors min-h-[44px]" id="cancel-btn">Cancelar</button>
                        <button class="px-4 py-3 bg-red-500 text-white hover:bg-red-600 rounded transition-colors min-h-[44px]" id="confirm-btn">Confirmar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('#cancel-btn').onclick = () => modal.remove();
            modal.querySelector('#confirm-btn').onclick = () => {
                modal.remove();
                if (typeof onConfirm === 'function') onConfirm();
            };
        }

        function showPasswordDialog(paginaDestino) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100">üîí Acesso Restrito</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4 text-sm">Digite a senha para acessar esta p√°gina:</p>
                    <input type="password" id="password-input" placeholder="Digite a senha" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none bg-white dark:bg-gray-700 mb-4">
                    <div class="flex flex-col md:flex-row justify-end space-y-2 md:space-y-0 md:space-x-3">
                        <button class="px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors min-h-[44px]" onclick="this.closest('.fixed').remove()">Cancelar</button>
                        <button class="px-4 py-3 bg-primary text-white hover:bg-primary-dark rounded transition-colors min-h-[44px]" onclick="verificarSenha('${paginaDestino}', this.closest('.fixed'))">üîì Acessar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            const passwordInput = modal.querySelector('#password-input');
            passwordInput.focus();
            passwordInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    verificarSenha(paginaDestino, modal);
                }
            });
        }

        function verificarSenha(paginaDestino, modal) {
            const senhaDigitada = modal.querySelector('#password-input').value;
            if (senhaDigitada === senhaAtual) {
                modal.remove();
                document.querySelectorAll('.page-content').forEach(page => {
                    page.classList.add('hidden');
                });
                document.getElementById(paginaDestino + '-page').classList.remove('hidden');
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('text-primary', 'font-semibold');
                    btn.classList.add('text-gray-500');
                });
                document.getElementById('nav-' + paginaDestino).classList.add('text-primary', 'font-semibold');
                document.getElementById('nav-' + paginaDestino).classList.remove('text-gray-500');
                paginaAtual = paginaDestino;
                if (paginaDestino === 'gerenciamento') {
                    atualizarTabelaPedidos();
                    atualizarEstatisticas();
                } else if (paginaDestino === 'relatorio') {
                    atualizarRelatorio();
                    aplicarFiltros();
                }
            } else {
                showCustomAlert('‚ùå Senha incorreta!');
            }
        }

        document.getElementById('search-input').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                buscarConvidados();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            atualizarEstatisticas();
        });
    </script>
</body>
</html>
